<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é€šå­¦ã‚¨ãƒªã‚¢ãƒ©ã‚¤ãƒ–ã‚«ãƒ¡ãƒ©</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');

    :root {
      --bg: #f8fafc;
      --panel: #ffffff;
      --border: #e2e8f0;
      --accent: #ef4444; /* ğŸ”ºã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
      --text-main: #1e293b;
      --text-sub: #64748b;
      --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text-main);
      font-family: 'Noto Sans JP', sans-serif;
      line-height: 1.6;
    }

    header {
      padding: 2rem;
      background: #ffffff;
      border-bottom: 3px solid var(--accent);
      text-align: center;
      margin-bottom: 2rem;
      box-shadow: var(--shadow);
    }

    header h1 {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text-main);
      letter-spacing: 0.05em;
    }

    main { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem 3rem; }
    .section { margin-bottom: 3rem; }

    .section-label {
      display: flex; align-items: center; gap: 0.5rem;
      margin-bottom: 1.5rem; padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--border);
    }

    .section-label h2 {
      font-size: 1.2rem; font-weight: 700; color: var(--text-main);
    }

    .accent-icon { color: var(--accent); font-size: 1.2rem; }

    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 1.5rem; }

    .cam-card {
      background: var(--panel); border: 1px solid var(--border);
      border-radius: 12px; overflow: hidden;
      display: flex; flex-direction: column;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      transition: transform 0.2s;
    }
    .cam-card:hover { transform: translateY(-4px); box-shadow: var(--shadow); }

    .cam-title {
      padding: 0.8rem 1rem; font-weight: 700; font-size: 0.95rem;
      background: #f1f5f9; border-bottom: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center;
    }

    .timer-badge {
      font-size: 0.75rem; color: #ffffff; background: var(--text-sub);
      padding: 2px 8px; border-radius: 999px; min-width: 45px; text-align: center;
    }

    .cam-body {
      position: relative; width: 100%; padding-top: 56.25%;
      background: #e2e8f0; overflow: hidden;
    }

    .cam-body iframe,
    .cam-body img.live-img {
      position: absolute; top:0; left:0; width:100%; height:100%;
      border: none; object-fit: cover;
    }

    .img-overlay {
      position: absolute; top:0; left:0; width:100%; height:100%;
      display: flex; align-items: center; justify-content: center;
      background: #f1f5f9; transition: opacity 0.4s; z-index: 2;
    }
    .img-overlay.hidden { opacity: 0; pointer-events: none; }

    .spinner {
      width: 24px; height: 24px; border: 3px solid var(--border);
      border-top-color: var(--accent); border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .fallback-inner {
      position: absolute; top:0; left:0; width:100%; height:100%;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      gap: 0.8rem; text-align: center; padding: 1rem; background: #f8fafc;
    }
    .fallback-inner p { font-size: 0.8rem; color: var(--text-sub); font-weight: 500; }
    
    .open-btn {
      display: inline-block; padding: 0.5rem 1.2rem;
      background: var(--accent); color: #ffffff; text-decoration: none;
      font-size: 0.85rem; font-weight: 700; border-radius: 6px;
      transition: opacity 0.2s;
    }
    .open-btn:hover { opacity: 0.8; }

    .refresh-note {
      font-size: 0.75rem; color: var(--text-sub);
      padding: 0.5rem 1rem; text-align: right; background: #ffffff;
    }

    footer {
      text-align: center; padding: 2rem;
      font-size: 0.8rem; color: var(--text-sub);
      border-top: 1px solid var(--border);
    }

    @media (max-width: 640px) {
      .grid { grid-template-columns: 1fr; }
      header h1 { font-size: 1.4rem; }
    }
  </style>
</head>
<body>

<header>
  <h1>é€šå­¦ã‚¨ãƒªã‚¢ãƒ©ã‚¤ãƒ–ã‚«ãƒ¡ãƒ©</h1>
</header>

<main>

  <section class="section">
    <div class="section-label">
      <span class="accent-icon">ğŸ”º</span>
      <h2>æœ­å¹Œä¸­å¿ƒéƒ¨</h2>
    </div>
    <div class="grid">
      <div class="cam-card">
        <div class="cam-title">
          <span>å¤§é€šå…¬åœ’è¥¿4ä¸ç›® â€” STV</span>
          <span class="timer-badge" id="timer-stv-odori">60s</span>
        </div>
        <div class="cam-body" id="wrap-stv-odori">
          <img class="live-img" id="img-stv-odori" alt="STVå¤§é€šå…¬åœ’">
          <div class="img-overlay" id="ov-stv-odori"><div class="spinner"></div></div>
        </div>
        <div class="refresh-note">60ç§’è‡ªå‹•æ›´æ–° ï¼ é…ä¿¡: STV</div>
      </div>

      <div class="cam-card">
        <div class="cam-title">
          <span>å¤§é€šãƒ“ãƒƒã‚» â€” HBC</span>
          <span class="timer-badge" id="timer-hbc-odori">60s</span>
        </div>
        <div class="cam-body" id="wrap-hbc-odori">
          <img class="live-img" id="img-hbc-odori" alt="HBCå¤§é€šãƒ“ãƒƒã‚»">
          <div class="img-overlay" id="ov-hbc-odori"><div class="spinner"></div></div>
        </div>
        <div class="refresh-note">60ç§’è‡ªå‹•æ›´æ–° ï¼ é…ä¿¡: HBC</div>
      </div>

      <div class="cam-card">
        <div class="cam-title">
          <span>JRæœ­å¹Œé§…ãƒ›ãƒ¼ãƒ  â€” HBC</span>
          <span class="timer-badge" id="timer-hbc-jrsa">60s</span>
        </div>
        <div class="cam-body" id="wrap-hbc-jrsa">
          <img class="live-img" id="img-hbc-jrsa" alt="HBC JRæœ­å¹Œé§…">
          <div class="img-overlay" id="ov-hbc-jrsa"><div class="spinner"></div></div>
        </div>
        <div class="refresh-note">60ç§’è‡ªå‹•æ›´æ–° ï¼ é…ä¿¡: HBC</div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="section-label">
      <span class="accent-icon">ğŸ”º</span>
      <h2>æ–°ã•ã£ã½ã‚å‘¨è¾º</h2>
    </div>
    <div class="grid">
      <div class="cam-card">
        <div class="cam-title">
          <span>åšåˆ¥åŒºå°é‡å¹Œ â€” å›½é“12å·</span>
          <span class="timer-badge" id="timer-r12-kono">90s</span>
        </div>
        <div class="cam-body" id="wrap-r12-kono">
          <img class="live-img" id="img-r12-kono" alt="å›½é“12å·å°é‡å¹Œ">
          <div class="img-overlay" id="ov-r12-kono"><div class="spinner"></div></div>
        </div>
        <div class="refresh-note">90ç§’è‡ªå‹•æ›´æ–° ï¼ é…ä¿¡: åŒ—æµ·é“é–‹ç™ºå±€</div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="section-label">
      <span class="accent-icon">ğŸ”º</span>
      <h2>å­¦æ ¡å‘¨è¾º</h2>
    </div>
    <div class="grid">
      <div class="cam-card">
        <div class="cam-title">
          <span>æ —å±±ç”ºä¸Šç©º â€” æ —å±±ç”ºå½¹å ´</span>
        </div>
        <div class="cam-body" id="wrap-kuriyama">
          <div class="fallback-inner">
            <p>å…¬å¼ã‚µã‚¤ãƒˆã®åˆ¶é™ã«ã‚ˆã‚Šè¡¨ç¤ºã§ãã¾ã›ã‚“</p>
            <a class="open-btn" href="https://www.town.kuriyama.hokkaido.jp/livecam/" target="_blank" rel="noopener">â–¶ ãƒ©ã‚¤ãƒ–ã‚«ãƒ¡ãƒ©ã‚’é–‹ã</a>
          </div>
        </div>
        <div class="refresh-note">é…ä¿¡: æ —å±±ç”ºå½¹å ´</div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="section-label">
      <span class="accent-icon">ğŸ”º</span>
      <h2>åŒ—åºƒå³¶ãƒ»æµåº­ãƒ»æ±Ÿåˆ¥</h2>
    </div>
    <div class="grid">
      <div class="cam-card">
        <div class="cam-title">
          <span>ã‚¨ã‚¹ã‚³ãƒ³ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä»˜è¿‘ â€” STV</span>
        </div>
        <div class="cam-body">
          <iframe src="https://www.youtube.com/embed/C28jH3sU2M8?autoplay=1&mute=1"
            title="STVåŒ—åºƒå³¶" allowfullscreen></iframe>
        </div>
        <div class="refresh-note">å‹•ç”»ãƒ©ã‚¤ãƒ– ï¼ é…ä¿¡: STV</div>
      </div>

      <div class="cam-card">
        <div class="cam-title">
          <span>æµåº­å¸‚æµå— â€” å›½é“36å·</span>
          <span class="timer-badge" id="timer-r36-enami">90s</span>
        </div>
        <div class="cam-body" id="wrap-r36-enami">
          <img class="live-img" id="img-r36-enami" alt="å›½é“36å·æµåº­æµå—">
          <div class="img-overlay" id="ov-r36-enami"><div class="spinner"></div></div>
        </div>
        <div class="refresh-note">90ç§’è‡ªå‹•æ›´æ–° ï¼ é…ä¿¡: åŒ—æµ·é“é–‹ç™ºå±€</div>
      </div>

      <div class="cam-card">
        <div class="cam-title">
          <span>æ±Ÿåˆ¥å¤ª â€” å›½é“12å·</span>
          <span class="timer-badge" id="timer-r12-ebetsu">90s</span>
        </div>
        <div class="cam-body" id="wrap-r12-ebetsu">
          <img class="live-img" id="img-r12-ebetsu" alt="å›½é“12å·æ±Ÿåˆ¥å¤ª">
          <div class="img-overlay" id="ov-r12-ebetsu"><div class="spinner"></div></div>
        </div>
        <div class="refresh-note">90ç§’è‡ªå‹•æ›´æ–° ï¼ é…ä¿¡: åŒ—æµ·é“é–‹ç™ºå±€</div>
      </div>
    </div>
  </section>

</main>

<footer>
  é€šå­¦ã‚¨ãƒªã‚¢ãƒ©ã‚¤ãƒ–ã‚«ãƒ¡ãƒ© â€” é…ä¿¡å…ƒã®éƒ½åˆã«ã‚ˆã‚Šåœæ­¢ãƒ»å¤‰æ›´ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™
</footer>

<script>
const CAMERAS = [
  { id:'stv-odori',   type:'img',  interval:60, src:'https://www.stv.jp/cameraimg/ohdori4_L.jpg' },
  { id:'hbc-odori',   type:'img',  interval:60, src:'https://www.hbc.co.jp/info-cam/media/sapporohd_720.jpg' },
  { id:'hbc-jrsa',    type:'img',  interval:60, src:'https://www.hbc.co.jp/info-cam/media/jrsapporohd_720.jpg' },
  { id:'r12-kono',    type:'page', interval:90, pageUrl:'https://www.road-info-prvs.mlit.go.jp/roadinfo/sp/spImageDetail_8118200102.html' },
  { id:'r36-enami',   type:'page', interval:90, pageUrl:'https://www.road-info-prvs.mlit.go.jp/roadinfo/sp/spImageDetail_8118900103.html' },
  { id:'r12-ebetsu',  type:'page', interval:90, pageUrl:'https://www.road-info-prvs.mlit.go.jp/roadinfo/sp/spImageDetail_8118200110.html' },
];

function loadImgCamera(cam) {
  const img  = document.getElementById('img-' + cam.id);
  const ov   = document.getElementById('ov-'  + cam.id);
  if (!img) return;
  const url = cam.src + '?_=' + Date.now();
  const tmp = new Image();
  tmp.onload = () => { img.src = url; ov && ov.classList.add('hidden'); };
  tmp.src = url;
}

async function loadPageCamera(cam) {
  const ov = document.getElementById('ov-' + cam.id);
  const img = document.getElementById('img-' + cam.id);
  if (!img) return;
  const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(cam.pageUrl);
  try {
    const res  = await fetch(proxyUrl);
    const json = await res.json();
    const html = json.contents || '';
    const match = html.match(/src=["']([^"']*\.jpg[^"']*)/i);
    if (match) {
      let imgSrc = match[1];
      if (imgSrc.startsWith('/')) imgSrc = 'https://www.road-info-prvs.mlit.go.jp' + imgSrc;
      const imgProxy = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(imgSrc + '?_=' + Date.now());
      const tmp = new Image();
      tmp.onload = () => { img.src = imgProxy; ov && ov.classList.add('hidden'); };
      tmp.src = imgProxy;
    }
  } catch (e) {}
}

function startTimer(cam) {
  const badge = document.getElementById('timer-' + cam.id);
  if (!badge) return;
  let remaining = cam.interval;
  setInterval(() => {
    remaining--;
    badge.textContent = remaining + 's';
    if (remaining <= 0) {
      remaining = cam.interval;
      if (cam.type === 'img') loadImgCamera(cam);
      else loadPageCamera(cam);
    }
  }, 1000);
}

document.addEventListener('DOMContentLoaded', () => {
  CAMERAS.forEach(cam => {
    if (cam.type === 'img')  loadImgCamera(cam);
    else                     loadPageCamera(cam);
    startTimer(cam);
  });
});
</script>

</body>
</html>
